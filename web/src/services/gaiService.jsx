// Import
import axios from 'axios';

// Import GAI
import { GoogleGenerativeAI, HarmCategory, HarmBlockThreshold } from "@google/generative-ai";

// Fn to fetch the AI API Key from backend
async function googleAiKey() {
    try {
        const response = await axios.get('http://localhost:9900/api/get-gai-key');
        // const data = await response.json();
        // return data.gaiKey;

        // console.log("Here is gai key", response.data.gaiKey)
        return response.data.gaiKey;
    } catch (error) {
        console.error('Error fetching AI API Key:', error);
        throw error;
    }
}

// Fn to create chat session by using the AI model
export async function createChatSession() {
    try {
        // Fetch the API Key
        const apiKey = await googleAiKey();
        const genAI = new GoogleGenerativeAI(apiKey);

        const model = genAI.getGenerativeModel({
            model: "gemini-1.5-flash",
        });

        const generationConfig = {
            temperature: 1,
            topP: 0.95,
            topK: 64,
            maxOutputTokens: 8192,
            responseMimeType: "application/json",
        };

        const chatSession = model.startChat({
            generationConfig,
            history: [
                {
                    role: "user",
                    parts: [
                      {text: "Generate Travel Plan for Destination: China, for 10 Days for Couple with Economy budget. Give me a HotelOptions list with at least 4-5 options including HotelName, HotelAddress, HotelPrice per day currency in Thai Bath, HotelGeoCoordinates including latitude and  longitude, HotelRating, HotelDescription. Suggest an itinerary with at least 4-5 places to visit per day show day such as Day: 1, including PlaceName, PlaceDetails, PlaceGeoCoordinates including latitude and  longitude, TicketPricing currency in Thai Bath (if any), including StartTime and EndTime for visiting each place, in JSON format."},
                    ],
                  },
                  {
                    role: "model",
                    parts: [
                      {text: "```json\n{\"HotelOptions\": [{\"HotelName\": \"The Peninsula Beijing\", \"HotelAddress\": \"8 Goldfish Lane, Wangfujing, Dongcheng District, Beijing, China\", \"HotelPrice\": \"12000\", \"HotelGeoCoordinates\": {\"latitude\": \"39.9141\", \"longitude\": \"116.4074\"}, \"HotelRating\": \"5\", \"HotelDescription\": \"A luxurious hotel with stunning views of the Forbidden City.\"}, {\"HotelName\": \"Grand Hyatt Beijing\", \"HotelAddress\": \"1 East Chang An Avenue, Dongcheng District, Beijing, China\", \"HotelPrice\": \"8000\", \"HotelGeoCoordinates\": {\"latitude\": \"39.9142\", \"longitude\": \"116.4038\"}, \"HotelRating\": \"4.5\", \"HotelDescription\": \"A modern hotel with a rooftop bar and excellent dining options.\"}, {\"HotelName\": \"The Ritz-Carlton, Beijing, Financial Street\", \"HotelAddress\": \"No. 3, Financial Street, Xicheng District, Beijing, China\", \"HotelPrice\": \"10000\", \"HotelGeoCoordinates\": {\"latitude\": \"39.9062\", \"longitude\": \"116.3913\"}, \"HotelRating\": \"5\", \"HotelDescription\": \"A sophisticated hotel with exceptional service and a prime location.\"}, {\"HotelName\": \"The Mandarin Oriental, Beijing\", \"HotelAddress\": \"22 Wangfujing Street, Dongcheng District, Beijing, China\", \"HotelPrice\": \"9000\", \"HotelGeoCoordinates\": {\"latitude\": \"39.9153\", \"longitude\": \"116.4085\"}, \"HotelRating\": \"4.5\", \"HotelDescription\": \"A stylish hotel with a renowned spa and fine dining restaurants.\"}], \"Itinerary\": [{\"Day\": \"1\", \"Places\": [{\"PlaceName\": \"Forbidden City\", \"PlaceDetails\": \"A UNESCO World Heritage Site and a must-see in Beijing. Explore the imperial palaces, gardens, and museums.\", \"PlaceGeoCoordinates\": {\"latitude\": \"39.9167\", \"longitude\": \"116.3972\"}, \"TicketPricing\": \"60\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Tiananmen Square\", \"PlaceDetails\": \"The heart of Beijing, where major political events take place. Witness the grandeur of the square.\", \"PlaceGeoCoordinates\": {\"latitude\": \"39.9152\", \"longitude\": \"116.4037\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"Temple of Heaven\", \"PlaceDetails\": \"A UNESCO World Heritage Site dedicated to heaven worship. Admire the intricate architecture and serene atmosphere.\", \"PlaceGeoCoordinates\": {\"latitude\": \"39.8975\", \"longitude\": \"116.4108\"}, \"TicketPricing\": \"40\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"2\", \"Places\": [{\"PlaceName\": \"Great Wall of China (Mutianyu Section)\", \"PlaceDetails\": \"Hike or take a cable car to the iconic Great Wall. Enjoy panoramic views and explore the watchtowers.\", \"PlaceGeoCoordinates\": {\"latitude\": \"40.4333\", \"longitude\": \"116.5667\"}, \"TicketPricing\": \"100\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Ming Tombs\", \"PlaceDetails\": \"A complex of imperial tombs from the Ming Dynasty. Visit the impressive architecture and learn about Chinese history.\", \"PlaceGeoCoordinates\": {\"latitude\": \"40.1831\", \"longitude\": \"116.4567\"}, \"TicketPricing\": \"60\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"3\", \"Places\": [{\"PlaceName\": \"Summer Palace\", \"PlaceDetails\": \"A UNESCO World Heritage Site and a sprawling imperial garden. Explore the lakes, pagodas, and halls.\", \"PlaceGeoCoordinates\": {\"latitude\": \"40.0325\", \"longitude\": \"116.3108\"}, \"TicketPricing\": \"60\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"798 Art District\", \"PlaceDetails\": \"A contemporary art district with galleries, studios, and cafes. Discover emerging Chinese artists and creative spaces.\", \"PlaceGeoCoordinates\": {\"latitude\": \"40.0122\", \"longitude\": \"116.4788\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"Nanluoguxiang\", \"PlaceDetails\": \"A lively street with traditional courtyards, teahouses, and street food stalls. Experience the local culture and enjoy the vibrant atmosphere.\", \"PlaceGeoCoordinates\": {\"latitude\": \"39.9192\", \"longitude\": \"116.4003\"}, \"TicketPricing\": \"0\", \"StartTime\": \"11:00\", \"EndTime\": \"21:00\"}]}, {\"Day\": \"4\", \"Places\": [{\"PlaceName\": \"Shanghai\", \"PlaceDetails\": \"Fly to Shanghai, China's bustling metropolis. Take a scenic boat tour on the Huangpu River and enjoy the city's skyline.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2304\", \"longitude\": \"121.4737\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"The Bund\", \"PlaceDetails\": \"Shanghai's iconic waterfront with historic buildings and modern skyscrapers. Take a stroll along the promenade and admire the views.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2322\", \"longitude\": \"121.4847\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"Yuyuan Garden\", \"PlaceDetails\": \"A classic Chinese garden with a pond, pavilions, and beautiful landscaping. Explore the traditional architecture and relax in the peaceful atmosphere.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2356\", \"longitude\": \"121.4892\"}, \"TicketPricing\": \"40\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"5\", \"Places\": [{\"PlaceName\": \"Oriental Pearl Tower\", \"PlaceDetails\": \"A landmark skyscraper with stunning views of Shanghai. Take the elevator to the observation decks and enjoy panoramic vistas.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2453\", \"longitude\": \"121.4953\"}, \"TicketPricing\": \"150\", \"StartTime\": \"9:00\", \"EndTime\": \"21:00\"}, {\"PlaceName\": \"Shanghai Museum\", \"PlaceDetails\": \"A world-class museum showcasing Chinese art, calligraphy, and ceramics. Explore the extensive collection and learn about Chinese history and culture.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2345\", \"longitude\": \"121.4985\"}, \"TicketPricing\": \"30\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Xintiandi\", \"PlaceDetails\": \"A trendy district with chic boutiques, restaurants, and bars. Discover the latest fashion and enjoy the vibrant nightlife.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.2222\", \"longitude\": \"121.4778\"}, \"TicketPricing\": \"0\", \"StartTime\": \"11:00\", \"EndTime\": \"21:00\"}]}, {\"Day\": \"6\", \"Places\": [{\"PlaceName\": \"Water Town of Zhujiajiao\", \"PlaceDetails\": \"A charming water town with canals, bridges, and traditional houses. Explore the scenic waterways and enjoy the local atmosphere.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.0511\", \"longitude\": \"121.1286\"}, \"TicketPricing\": \"100\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Thames Town\", \"PlaceDetails\": \"A unique town built in the style of an English village. Stroll along the cobblestone streets and admire the quaint buildings.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.0342\", \"longitude\": \"121.1458\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}]}, {\"Day\": \"7\", \"Places\": [{\"PlaceName\": \"Suzhou\", \"PlaceDetails\": \"A historic city known for its canals, gardens, and silk production. Visit the beautiful classical gardens and learn about the city's rich heritage.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.3222\", \"longitude\": \"120.6167\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"The Humble Administrator's Garden\", \"PlaceDetails\": \"A UNESCO World Heritage Site and a stunning example of Chinese garden design. Explore the serene pavilions, bridges, and ponds.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.3167\", \"longitude\": \"120.625\"}, \"TicketPricing\": \"70\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Lion Grove Garden\", \"PlaceDetails\": \"A unique garden with intricate rock formations, bonsai trees, and a maze-like layout. Admire the artistic beauty and enjoy the tranquility.\", \"PlaceGeoCoordinates\": {\"latitude\": \"31.3208\", \"longitude\": \"120.6167\"}, \"TicketPricing\": \"40\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"8\", \"Places\": [{\"PlaceName\": \"Hangzhou\", \"PlaceDetails\": \"A scenic city known for its West Lake and tea plantations. Take a boat ride on the lake and enjoy the beautiful surroundings.\", \"PlaceGeoCoordinates\": {\"latitude\": \"30.2581\", \"longitude\": \"120.1934\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"West Lake\", \"PlaceDetails\": \"A UNESCO World Heritage Site and a scenic lake with pagodas, islands, and beautiful gardens. Enjoy a leisurely stroll along the lakeside or take a boat trip.\", \"PlaceGeoCoordinates\": {\"latitude\": \"30.2625\", \"longitude\": \"120.1934\"}, \"TicketPricing\": \"0\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"Longjing Tea Plantation\", \"PlaceDetails\": \"Visit a tea plantation and learn about the process of growing and harvesting tea. Sample different varieties and enjoy the scenic views.\", \"PlaceGeoCoordinates\": {\"latitude\": \"30.2153\", \"longitude\": \"120.1361\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"9\", \"Places\": [{\"PlaceName\": \"Xi'an\", \"PlaceDetails\": \"A historic city known for its terracotta army and ancient city walls. Visit the UNESCO World Heritage Site and explore the city's rich history.\", \"PlaceGeoCoordinates\": {\"latitude\": \"34.2641\", \"longitude\": \"108.9528\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"Terracotta Army\", \"PlaceDetails\": \"A UNESCO World Heritage Site and one of the most impressive archaeological discoveries in the world. See the thousands of life-size terracotta warriors and horses.\", \"PlaceGeoCoordinates\": {\"latitude\": \"34.2339\", \"longitude\": \"108.9523\"}, \"TicketPricing\": \"150\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}, {\"PlaceName\": \"City Wall of Xi'an\", \"PlaceDetails\": \"Walk or bike along the well-preserved ancient city walls. Enjoy the panoramic views and learn about the city's history.\", \"PlaceGeoCoordinates\": {\"latitude\": \"34.2633\", \"longitude\": \"108.9511\"}, \"TicketPricing\": \"50\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}, {\"Day\": \"10\", \"Places\": [{\"PlaceName\": \"Muslim Quarter\", \"PlaceDetails\": \"A vibrant district with traditional architecture, mosques, and street food stalls. Enjoy the lively atmosphere and sample delicious local cuisine.\", \"PlaceGeoCoordinates\": {\"latitude\": \"34.2583\", \"longitude\": \"108.9508\"}, \"TicketPricing\": \"0\", \"StartTime\": \"10:00\", \"EndTime\": \"18:00\"}, {\"PlaceName\": \"Big Wild Goose Pagoda\", \"PlaceDetails\": \"A Buddhist temple with a towering pagoda. Climb to the top for panoramic views of the city and learn about the history of Buddhism in China.\", \"PlaceGeoCoordinates\": {\"latitude\": \"34.2489\", \"longitude\": \"108.9478\"}, \"TicketPricing\": \"40\", \"StartTime\": \"9:00\", \"EndTime\": \"17:00\"}]}]}\n\n\n```"},
                    ],
                  },
            ],
        });

        return chatSession

    } catch (error) {
        console.error('Error running AI model:', error);
    }
}